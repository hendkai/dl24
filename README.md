# ðŸ”‹ DL24P Battery Tester - Web GUI & Python Control

[![Live Demo](https://img.shields.io/badge/ðŸš€_Live_Demo-Try_Now!-00d4aa?style=for-the-badge)](https://hendkai.github.io/dl24/demo.html)
[![Python](https://img.shields.io/badge/Python-3.7+-blue?style=flat-square&logo=python)](https://python.org)
[![License](https://img.shields.io/badge/License-MIT-green?style=flat-square)](LICENSE)

**Professional battery testing with real-time monitoring, custom test cycles, and data visualization.**

Control your Atorch DL24P electronic load via USB, Bluetooth, or TCP with a modern web interface or command line.

---

## âœ¨ Features

| Feature | Description |
|---------|-------------|
| ðŸŒ **Web GUI** | Modern dark-themed interface with real-time charts |
| ðŸ“Š **Live Monitoring** | Voltage, current, power, capacity, energy, temperature |
| ðŸ”„ **Custom Cycles** | Build multi-phase test cycles with the Cycle Builder |
| ðŸ’¾ **Data Export** | CSV export with all measurements |
| ðŸ“ˆ **Analysis** | Automatic post-test battery ratings |
| ðŸ”Œ **Flexible Connection** | USB serial, Bluetooth, or TCP |

---

## ðŸš€ Quick Start

### Web GUI (Recommended)

```bash
# Clone & install
git clone https://github.com/hendkai/dl24.git
cd dl24
pip3 install -r requirements.txt

# Configure device
echo "serport=/dev/ttyUSB0" > ~/.dl24.cfg

# Start web server
./dl24_webserver.py

# Open http://localhost:5000
```

### Command Line

```bash
# Simple discharge test
./dl24.py 1A 2.5VCUT ON

# Query status
./dl24.py STATE

# Monitor live
./dl24.py LISTEN:10
```

---

## ðŸ“– Documentation

- **[Web GUI Guide](WEB_GUI.md)** - Complete web interface documentation
- **[Live Demo](https://hendkai.github.io/dl24/demo.html)** - Try the interface (simulation mode)

---

## ðŸ”§ Supported Hardware

- **Atorch DL24P** (tested)
- Other Atorch loads with similar protocol

---

## ðŸ“¦ Requirements

- Python 3.7+
- pyserial
- Flask, Flask-CORS, Flask-SocketIO (for web GUI)

---

## ðŸ“„ Technical Documentation

Autogenerated from [https://www.improwis.com/projects/sw_dl24/](https://www.improwis.com/projects/sw_dl24/)






DL24.py, python control for DL24P and other Atorch artificial loads








DL24.py, python control for DL24P and other Atorch artificial loads
===================================================================



---

![](thumb.ATorchDL24P-adhoc.jpg)

[Why](#Why "#Why")  
[Hardware description](#Hardwaredescription "Hardware description")  
Â Â Â Â Â Â [load modes](#loadmodes "Hardware description.load modes")  
Â Â Â Â Â Â [hardware architecture](#hardwarearchitecture "Hardware description.hardware architecture")  
Â Â Â Â Â Â Â Â Â Â Â Â [connectors](#connectors "Hardware description.hardware architecture.connectors")  
Â Â Â Â Â Â Â Â Â Â Â Â [buttons](#buttons "Hardware description.hardware architecture.buttons")  
[How](#How "How")  
Â Â Â Â Â Â [dependencies](#dependencies "How.dependencies")  
Â Â Â Â Â Â [protocol](#protocol "How.protocol")  
Â Â Â Â Â Â Â Â Â Â Â Â [PX100Â protocol](#PX100nbspprotocol "How.protocol.PX100Â protocol")  
Â Â Â Â Â Â Â Â Â Â Â Â ["Atorch" protocol](#Atorchprotocol "How.protocol.")  
Â Â Â Â Â Â Â Â Â Â Â Â [transaction examples](#transactionexamples "How.protocol.transaction examples")  
[Usage](#Usage "Usage")  
Â Â Â Â Â Â [hardware configuration](#hardwareconfiguration "Usage.hardware configuration")  
Â Â Â Â Â Â [commands](#commands "Usage.commands")  
Â Â Â Â Â Â [settings](#settings "Usage.settings")  
Â Â Â Â Â Â [miniscripts](#miniscripts "Usage.miniscripts")  
Â Â Â Â Â Â Â Â Â Â Â Â [loops](#loops "Usage.miniscripts.loops")  
Â Â Â Â Â Â Â Â Â Â Â Â [stdin](#stdin "Usage.miniscripts.stdin")  
Â Â Â Â Â Â Â Â Â Â Â Â [data on one line](#dataononeline "Usage.miniscripts.data on one line")  
Â Â Â Â Â Â Â Â Â Â Â Â [connection persistence](#connectionpersistence "Usage.miniscripts.connection persistence")  
Â Â Â Â Â Â [verbosity](#verbosity "Usage.verbosity")  
Â Â Â Â Â Â [temperatures](#temperatures "Usage.temperatures")  
Â Â Â Â Â Â [autoconfiguration](#autoconfiguration "Usage.autoconfiguration")  
Â Â Â Â Â Â [debug](#debug "Usage.debug")  
Â Â Â Â Â Â Â Â Â Â Â Â [protocol reverse engineering aids](#protocolreverseengineeringaids "Usage.debug.protocol reverse engineering aids")  
[Files](#Files "Files")  
[TODO](#TODO "TODO")  


---

Why
---



It was necessary to control an Atorch DL24P constant-current load for some lab automation purposes.
The stock software was useless for theÂ purpose, surprise surprise.




There is aÂ fragmentary documentation of theÂ protocol online, all over theÂ Internet and over various
code implementations of varying completeness.




The device communicates over aÂ standard UART at 9600Â bps, no parity, 1Â stopbit (the most common setting),
using aÂ custom packet-based protocol.




The serial bus can be accessed over either aÂ USB-serial converter based on CH340G chip (warning: no
galvanic isolation!), or via Bluetooth serial interface, using aÂ /dev/rfcommX port. Addition of
wifi-accessible serial interface is also possible, using eg. theÂ expedient plain
[serial-over-TCP](https://www.improwis.com/projects/hw_SerialOverTCP "local project") ("TasmoCOM") solution was chosen, leveraging ESP8266
and [Tasmota](https://en.wikipedia.org/wiki/Tasmota "Wikipedia link: Tasmota"), aÂ proven cheap and opensource approach.




The code is aÂ variant on theÂ control system for [RD60](https://www.improwis.com/projects/sw_rd60 "local project"), Riden RD60xx and RK60xx power supplies.




Tested with:
* DL24P





---

Hardware description
--------------------


### load modes



The device nominally supports several different load modes:
* CC - constant current, sinking preset current despite input voltage fluctuations
* CR - constant resistance, behaving like aÂ preset-value resistor, decreasing load with falling voltage
* CP - constant power, increasing load with falling voltage
* CV - constant voltage, maintaining voltage over theÂ load




Only theÂ CC mode is fully supported. The protocol does not allow selecting other modes, changing values for them,
nor even querying what mode is set.




The hardware in its current (2023) version looks like just slightly modified AC/DC power consumption measuring
device, with load control tacked on it. For sensing, separate dedicated load-measuring chips are used, and the
microcontroller communicated with them via internal UART bus. The Rx/Tx comm is naturally abysmally slow, dooming
any closed-loop regulation involving CPU to be abysmally unstable and often useless with more dynamic source.




The load itself is realized as aÂ big MOSFET on an even bigger actively cooled heatsink, likely aÂ surplus for
older CPUs. The MOSFET gate is fed with voltage from an op-amp, comparing signal from aÂ current-sensing resistor
with aÂ reference voltage coming from aÂ RC-filtered PWM from theÂ controller. This is aÂ pretty good closed-loop
regulation, bog-standard approach with minimal demands on theÂ CPU; in aÂ pinch, aÂ potentiometer can be used
for setting theÂ reference.




The advantage of using dedicated power consumption sensing chips is more reliable integration of the
consumed energy. Which is useful for theÂ device's primary purpose - testing batteries. For this use,
the device has aÂ voltage cutoff preset.



### hardware architecture


* [schematics (PDF)](DL24P-loadtester-schematic.pdf "local link: DL24P-loadtester-schematic.pdf") (thanks to Someone Unknown somewhere on theÂ Internet)


The device is built around several chips:
* control, user interface
+ HC32F030E8PA, Arm Cortex M0+ microcontroller, 64k flash/8k RAM (possibly, chip top is sanded off)
+ color TFT LCD SPI display



* communication
+ CH340G USB-UART converter, non-isolated
+ bluetooth module, type can be JDY-23Â (CC2541) or some SOIC8Â single-chip Bluetooth-serial from JieLi, likely AC6329A or AC6328A, on theÂ board on hand labeled BP05235-29A1
* data acquisition
+ RN8209C, aÂ utility smart meter power consumption integrator
- three sigma-delta ADCs, fully differential
- read via internal UART at fixed 4800Â bps
* current sensing resistor on channel A, using internal amplifier
* voltage sensing on channel C, using resistive divider
* external 10k NTC as temperature probe on channel B
* power control
+ two LM321Â in SOT23-5Â case marked A63A
+ STPS41H100CG, double Schottky diode in series with theÂ MOSFET, to protect it from reverse load
+ IRFP260, aÂ power N-MOSFET


The MOSFET is aÂ switching one, abused here in linear duty. Word goes along that some sellers use fake or reused ones,
and this component dies often. Prepare to replace it.




The UART has pins available near theÂ Bluetooth chip, left to right:
* GND (bluetooth chip pin 3)
* Rx (bluetooth chip Tx, pin 8)
* Tx (bluetooth chip Rx, pin 7)
* 3.3V (bluetooth chip pin 1)

This is aÂ tentative place to hook up theÂ wifi serial module.



#### connectors



On theÂ left side there is aÂ 4-pin screw clamp, for attaching source (outer pins) and source sensing (inner pins).
Either use aÂ [Kelvin connection](https://en.wikipedia.org/wiki/Kelvin_connection "Wikipedia link: Kelvin connection") or connect pins 1Â to 2Â and 3Â to 4Â and neglect theÂ (often significant) voltage drop on theÂ cables.




On theÂ right side there is aÂ 5.5/2.1mm barrel jack, connected in parallel to theÂ source pins. Do not mistake for theÂ other connector on theÂ back.
An adapter with aÂ barrel jack and USB-mini, USB-micro and USB-C connector is often available.




On theÂ right side there is also theÂ microUSB connector with USB-UART CH340G interface.




On theÂ back side there is one 5.5/2.1mm barrel jack for aÂ 9-to-12v power supply. This one feeds theÂ internal electronics (fan, op-amps,
3.3v linear regulator).



#### buttons



The unit has four buttons in aÂ diamond layout.
* top: SETTING
+ short press selects next item (cursor in theÂ Is (set current) field, fields in setting mode
+ long press allows selecting mode and accessing other variables - Vcut, timer...

* left: MINUS
+ decreases value under cursor

* right: PLUS
+ increases value under cursor
+ long press of MINUS and PLUS together

* bottom: START
+ short press switches theÂ load on or off
+ long press in OFF mode accesses settings menu (language, calibration, power limit...)





---

How
---



dl24.py, aÂ python-based (for portability) script, was written. The software allows both
using aÂ tty-style port and aÂ raw TCP socket, with no fancy RFC2217Â support. If theÂ latter is needed, URI-style
pyserial syntax is available with theÂ port.




The software defines aÂ hierarchy of classes:
* class LowLevelSerPort - for wired /dev/ttyX ports or full virtual ports
* class LowLevelTcpPort - for raw TCP sockets, TasmoCOM style
* class Instr\_Atorch - functions specific for theÂ DL24P and other Atorch devices, protocol, commands
* class PowerLoad - command interpreter, configfile reader



### dependencies



The software tries to minimize dependencies.




The mandatory ones, and mostly standard ones, are:
* socket (for TCP communication)
* time (for sleep)
* select (for nonblocking stdin reads)
* struct (pack/unpack, for conversion of packets to/from byte stream)

The nonmandatory, imported only as needed (so theÂ process would run when aÂ missing dependency is not required), are:
* serial (pyserial, for serial ports)
* datetime (for date/time settings)
* json (for JSON format output)



### protocol



The device communicates over aÂ bidirectional serial stream. There seem to be two different protocols, mixed together:
* PX100Â or PX-100, older, with fixed prefix and suffix and aÂ prayer for data integrity
* aÂ newer one, let's call it "Atorch", with fixed prefix and aÂ checksum



#### PX100Â protocol



Challenge-response, master-slave protocol. The device listens and only reacts to theÂ data sent.
* [https://github.com/misdoro/Electronic\_load\_px100/blob/master/protocol\_PX-100\_2\_70.md](https://github.com/misdoro/Electronic_load_px100/blob/master/protocol_PX-100_2_70.md "remote link: https://github.com/misdoro/Electronic_load_px100/blob/master/protocol_PX-100_2_70.md")




```
 request packet format:

        0xB1Â 0xB2Â [cmd] [d1] [d2] 0xB6
 on/off             01Â   xx   00Â       xx=01Â for on, 00Â for off
 set current        02Â   xx   yy       xx=integer, yy=decimal (00..99d)
 set cutoff v       03Â   xx   yy       ""
 set timeout        04Â   xx   yy       xxyy as unsigned int in seconds
 reset counters     05Â   00Â   00

 command response format: aÂ single byte, 0x6F (PROTO_SHORTACK)

 query response:
                  0xCA 0xCB [d1] [d2] [d3] 0xCE 0xCF
             for cmd code
 load enabled      10Â        00Â   00Â   xx          xx=00Â (off) or 01Â (on)
 measured mV       11Â        xx   yy   zz          0xXXYYZZ, 24bit integer
 measured mA       12Â        xx   yy   zz
 timer value       13Â        hh   mm   ss
 cap mAh           14Â        xx   yy   zz
 cap mWh           15Â        xx   yy   zz
 mosfet 'c         16Â        xx   yy   zz
 preset current    17Â        xx   yy   zz          10s mA
 preset cutoff     18Â        xx   yy   zz          10s mV
 preset timer      19Â        hh   mm   ss

 [cmd] code ranges 0x0? for command (with short response) and query (with long 7-byte response)

 On invalid command there is no response, theÂ command timeouts.

```
#### "Atorch" protocol



More modern protocol, combining fixed-format status updates in one-second intervals and challenge-response commands
* [https://github.com/devanlai/webvoltmeter/blob/master/REVERSE.md](https://github.com/devanlai/webvoltmeter/blob/master/REVERSE.md "remote link: https://github.com/devanlai/webvoltmeter/blob/master/REVERSE.md")
* [https://github.com/syssi/esphome-atorch-dl24/blob/main/docs/protocol-design.md](https://github.com/syssi/esphome-atorch-dl24/blob/main/docs/protocol-design.md "remote link: https://github.com/syssi/esphome-atorch-dl24/blob/main/docs/protocol-design.md")
* [https://werner.rothschopf.net/microcontroller/202204\_atorch\_dt24hd\_power\_sensor\_en.htm](https://werner.rothschopf.net/microcontroller/202204_atorch_dt24hd_power_sensor_en.htm "remote link: https://werner.rothschopf.net/microcontroller/202204_atorch_dt24hd_power_sensor_en.htm") - incl. parser decompiled from app
* [https://www.ordinoscope.net/index.php/Electronique/Hardware/Outils/Atorch/DL24P](https://www.ordinoscope.net/index.php/Electronique/Hardware/Outils/Atorch/DL24P "remote link: https://www.ordinoscope.net/index.php/Electronique/Hardware/Outils/Atorch/DL24P")




The packets have aÂ fixed overall structure with variable length:
* 0xFF 0x55 - aÂ fixed prefix, magic number
* type - packet type
+ 0x01 - periodic message, slave to master, 36Â bytes total
+ 0x02 - reply to request, slave to master, 8Â bytes total
+ 0x11 - request, master to slave, 10Â bytes total

* ADU - device type
+ 0x01 - AC power consumption meter
+ 0x02 - DC power consumption meter or artificial load; use for DL24
+ 0x03 - DC power consumption meter for USB power analyzers/monitors

* payload - variable length and content
+ type 0x01: 31Â bytes
+ type 0x02: 3Â bytes
+ type 0x03: 5Â bytes

* checksum - one byte, sum of bytes from (incl.) type to end of payload
+ byte by byte entire packet minus first two and one last bytes, AND 0xFF, XOR 0x44
+ use result for outgoing requests, check last byte for match for incoming messages




```
 Atorch protocol, type 0x01: 1-per-second, 36-byte: (pfct=power factor, bk=backlight)
                   x4Â               x8Â               xc               x10Â               x14Â               x18Â              x1c              x20
                   4Â                8Â                12Â               16Â                20Â                24Â               28Â               32
 [FF][55][01][02] [00][00][00] [00][00][00] [00][00][12] [00][00][00][00] [00][00][00] [00][00] [00][00] [00][17][00][00] [0A][33][3c][00] [00][00][00][E1]
 [FF][55][01][02] [00][00][33] [00][00][00] [00][00][12] [00][00][00][00] [00][00][00] [00][00] [00][00] [00][17][00][00] [0A][33][3c][00] [00][00][00][9C]
          t   01Â  -volt*0.1?-  -milliamps-  ---power---  ----energy-----   --price?--   -freq-   -pfct-   -temp-                   bk
          t   02Â  -volt*0.1--  -milliamps-  -amphours--  ----energy-----   --price?--            -pfct-   -temp-  --hhhh---mm--ss  bk
          t   03Â  -volt*0.1?-  -milliamps-  -amphours--  ----energy-----    usbd+   usbd-   -temp-   --hhhh---mm--ss  bk
             ADU      0.1v       0.001a       0.01Ah


 type 0x02, reply:
 [FF][55][02] [val0][val1][val2][val3] [checksum]
 for aÂ good command (0x32, button) theÂ response is 01Â 01Â 00Â 00
 for aÂ bad command (0x36) theÂ response is 01Â 03Â 00Â 00
 01Â 01Â seems to be good command
 01Â 03Â seems to be unimplemented command

 sample push of ON/OFF button: (cmd=0x32, values=[0,0,0,0])
 SEND: ff:55:11:02: 32Â :00:00:00:00Â :01
 RECV: ff:55:02: 01:01:00:00Â :40


 type 0x11, request:
 [FF][55][11][ADU] [cmd] [val0][val1][val2][val3] [checksum]  - val1Â seems to be always 0x00

 sample requests, as by http://bukys.eu/project/powermon/start :

   Commands for UD18Â UD24Â (USB)
     WH reset            FF 55Â 11Â 03Â 01Â 00Â 00Â 00Â 00Â 51
     AH reset            FF 55Â 11Â 03Â 02Â 00Â 00Â 00Â 00Â 52
     TIME reset          FF 55Â 11Â 03Â 03Â 00Â 00Â 00Â 00Â 53
     ALL reset           FF 55Â 11Â 03Â 05Â 00Â 00Â 00Â 00Â 5d
     SETUP Button        FF 55Â 11Â 03Â 31Â 00Â 00Â 00Â 00Â 01
     ENTER Button        FF 55Â 11Â 03Â 32Â 00Â 00Â 00Â 00Â 02
     [+] Button          FF 55Â 11Â 03Â 33Â 00Â 00Â 00Â 00Â 03
     [-] Button          FF 55Â 11Â 03Â 34Â 00Â 00Â 00Â 00Â 0C

  Commands for S1-B (USB)
     WH reset            FF 55Â 11Â 03Â 01Â 00Â 00Â 00Â 00Â 51
     Internal relay      FF 55Â 11Â 03Â 02Â 00Â 00Â 00Â 00Â 52
     TIME reset          FF 55Â 11Â 03Â 03Â 00Â 00Â 00Â 00Â 53

```
#### transaction examples



using protocol reverse engineering commands with VERB:CM

```
 CMD: RAWPX100:30
 SEND: b1:b2:30:00:00:b6
 REPLY TIMEOUT
 SEND: b1:b2:30:00:00:b6
 REPLY TIMEOUT
 SEND: b1:b2:30:00:00:b6
 REPLY TIMEOUT

 CMD: RAWPX100:01
 SEND: b1:b2:01:00:00:b6
 RECV: 6f

 CMD: RAWPX100:10
 SEND: b1:b2:10:00:00:b6
 RECV: ca:cb:00:00:00:ce:cf

 CMD: RAWPROTO:32
 SEND: ff:55:11:02:32:00:00:00:00:01
 RECV: ff:55:02:01:01:00:00:40

 CMD: RAWPROTO:FF
 SEND: ff:55:11:02:ff:00:00:00:00:56
 RECV: ff:55:02:01:03:00:00:42

```





---

Usage
-----



```
Atorch DL24 artificial control
Usage: ./dl24.py <command> [command]...
Commands:

  ON             enable output
  OFF            disable output

  nn.nnVCUT      set cutoff voltage
  nn.nnMA        set output current
  nn.nnA         set output current

  QV             query actual voltage
  QMV            query actual voltage, integer millivolts
  QA             query actual current
  QMA            query actual current, integer milliamps
  QTI            query internal temperature
  QVCUT          query cutoff voltage

  QAH            query amp-hour counter
  QMAH           query amp-hour counter in integer mAh
  QWH            query watt-hour counter
  QMWH           query watt-hour counter in integer mWh
  RESET          reset energy counters

  STATE[:opts]   print setting state in JSON format
  STATEJ[:opts]  print setting state in JSON format, like opts=J
          opts:  J=JSON, S=short (V/A only), T=show time, U=show UTC time, A=show all, B=force battery, M=minimize queries, L=listen-only
  LISTEN[:opts[:count]]  listen to status reports, query data, handle stdin
  LISTEN[:opts[:off]]    listen, until off
          opts:  J=JSON, S=short (V/A only), T=show time, U=show UTC time, A=show all, B=force battery, M=minimize queries, L=listen-only

  TCP=addr[:port]           set connection via TCP
  PORT=/dev/ttyport[@baud]  set connection via serial port
  WAIT           wait for communication from device
  ROBUST         increase timeouts and retries
  OFFOFF         switch output off on program exit
  STOPOFF        stop loop on output off

  STDIN          read commands from stdin
  LOOP:[xx]      loop for xx time or endless if not specified
  SLEEPxx        sleep for xx seconds
  VERB[:opts]    list operations
          opts:  P=port, C=communication, D=dataflow, M=commands
  LINE           output the Q-queries as space-separated instead of newline-separated
  TYPE           print detected device type
  CFGFILE        generate config file template to stdout

  RAWPROTO:xx[:xx:xx:xx:xx]   raw Atorch protocol send, cmd + 4 payloads
  RAWPX100:xx[:xx:xx]         raw PX100 protocol send, cmd + 2 payloads
  RAWSEND:xx[:xx:xx:...]      raw serial protocol data send
  NORETRY                     do not retry timeouted commands

For volt and amp setting, prefixing the value with + or - marks it as relative, to be added/subtracted to the current value
Commands are executed in sequence. Writes are cached and grouped together to minimize bus transactions.
Commands are case-insensitive.
Command "-" forces a newline into output.

```
### hardware configuration



The host:port or serport:baudrate are saved in ~/.dl24.cfg (or other name, where filename is derived from
the command by stripping theÂ .py suffix and prefixing aÂ home directory and aÂ dot). This variability allows
to use several symlinks for different power supplies simultaneously used, eg. as dl24a, dl24b,...




The configfile template can be generated on demand by command CFGFILE.




Directly, theÂ devices may be specified as TCP=<host>[:port]  or PORT=/dev/ttyUSBx@baudrate,
eg. TCP=10.0.1.15:8888 or PORT=/dev/rfcomm0 or PORT=/dev/ttyUSB1 (default speed is 9600, cannot be changed).




The PORT directive, both in command and in config, also supports theÂ [URL form](https://pyserial.readthedocs.io/en/latest/url_handlers.html "remote link: https://pyserial.readthedocs.io/en/latest/url_handlers.html").




For /dev/rfcomm devices used with Bluetooth, aÂ [wait](https://en.wikipedia.org/wiki/wait "Wikipedia link: wait") directive is needed. The port takes its
precious time to initialize, and waiting for first incoming data packet prevents initial timeouts.



### commands



The script takes aÂ sequence of commands from commandline, separated by spaces. Each command is aÂ single token,
optionally containing separator characters.




The commands can be aÂ fixed string (STATE, QV, ...) or aÂ prefix with value, or value with suffix (12.5A,
SLEEP1.5, QVCUT...)




Q-commands can be used to directly access theÂ measured or set values:
* QV, QA - for querying output voltage/amperage
* QMV, QMA - same, but integer value in millivolts/milliamps instead of float, for bash comparisons



### settings



The load current and voltage cutoff can be set with suffix-based commands.
For theÂ value of 1.23, theÂ commands are
* 1.23A - set load current
* 1230MA - set load current in milliamps
* 1.23VCUT - set voltage cutoff
* +1.23A - increase load current
* -1.23A - decrease load current
* +1230MA - increase load current in milliamps




Voltage cutoff does not support relative values, absolute shall be used.



### miniscripts



The commands are executed in order.



* set voltage cutoff and current, enable output
+ dl24.py 10.5vcut 550ma on

* toggle output, wait half second, show state
+ dl24.py toggle sleep0.5 state

* set output to 5Â amps and enable, wait aÂ second, increase by an amo, wait aÂ second, increase by another two amps, show state and power off
+ dl24.py on 5a sleep1 +1a sleep1 +2a sleep0.5 state off

* show input voltage and current
+ dl24.py qv qa

* show input voltage in millivolts and current in milliamps, space-separated
+ dl24.py qmv qma | tr '\n' ' '

* disable output, set cutoff voltage and current, enable output
+ dl24.py off 4.9vcut 1250ma on

#### loops



The LOOP: statement can be used for repeating of commands. The subsequent command set is repeated forever, or for specified number of times.



* show status in JSON format, forever
+ dl24.py loop: jstate

* ramp current by 20mA over time, from 0Â to 1A, watch status with timestamps:
+ dl24.py 0a on loop:50 +20ma sleep1 stat:jt

#### stdin



The commands can be sent from another script, via stdin. The STDIN statement has to be theÂ last on theÂ command line, everything after it is ignored.
* enable output, take file with currents, send in one per second, then disable output
+ cat file.txt | while read x; do echo $x; sleep 1; done | ./dl24.py on stdin; ./dl24.py off



#### data on one line



The LINE command sets theÂ separator character between Q-values from default newline to aÂ space. Groups of values then can be sent as single lines.
* check every 5Â seconds, send millivolts, milliamps, integrated amp-hours and watt-hours
+ dl24.py line loop: qmv qma qah qwh sleep5



#### connection persistence



The connection to theÂ port is opened when first needed, then kept open until theÂ process closes.




In some cases this may be detrimental to reliability (connection fail crashes theÂ process). Running it anew each time may be beneficial then.



### verbosity



To see theÂ port/socket opening/closing, and theÂ bus transactions dumped in hex, use VERB as theÂ first command.



./dl24.py verb:pc state
```
CONFIGFILE:filename: /root/.dl24.cfg
CONFIGFILE:FAIL: [Errno 2] No such file or directory: '/root/.dl24.cfg'
SERPORT:connecting to /dev/rfcomm0Â @ 9600
SERPORT:connected
waiting for incoming data
RECV: ff:55:01:02:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:17:00:00:00:04:3c:00:00:00:00:1e
SEND: b1:b2:10:00:00:b6
RECV: ca:cb:00:00:01:ce:cf
SEND: b1:b2:11:00:00:b6
RECV: ca:cb:00:00:00:ce:cf
SEND: b1:b2:12:00:00:b6
RECV: ca:cb:00:00:00:ce:cf
SEND: b1:b2:14:00:00:b6
RECV: ca:cb:00:00:00:ce:cf
SEND: b1:b2:15:00:00:b6
RECV: ca:cb:00:00:00:ce:cf
SEND: b1:b2:17:00:00:b6
RECV: ca:cb:00:00:63:ce:cf
SEND: b1:b2:18:00:00:b6
RECV: ca:cb:00:00:00:ce:cf
SEND: b1:b2:16:00:00:b6
RECV: ca:cb:00:00:17:ce:cf
SERPORT:closed

```
### temperatures



The board has aÂ connector for an external NTC probe temperature. The firmware does not support querying it as of late 2023.



### autoconfiguration



There is no way to query theÂ specific device type.
There is aÂ hint in theÂ protocol, theÂ ADU field in theÂ status packet. It can have different values describing the
packet format, theÂ field meanings; 1 is for AC sensors, 2 for DC sensors, 3 for USB DC sensors.




The TYPE command will show this value.




DT24Â devices are of type 2.



### debug



The verbose mode, VERB, provides access to several kinds of data:
* verb:P for port-related behavior (open/close)
* verb:C for communication data
* verb:D for data flow (less verbose comm)
* verb:M for coMmands



#### protocol reverse engineering aids



For understanding theÂ current, and checking theÂ future. Best used with VERB:PCM to see theÂ response.
* RAWPROTO:XXXXXXXXXX - send raw bytes via Atorch protocol, command + 4Â payloads in hex, auto-pads with zeroes
* RAWPX100:XXXXXX - send raw bytes via PX100Â protocol, command + 2Â payloads in hex, auto-pads with zeroes
* RAWSEND:XX.... - send raw bytes directly to port
* NORETRY - do not retry timeouted commands, for PX100Â protocol to speed up reaction and reduce clutter




Example of RAWSEND to elicit response from aÂ UM34C power monitor (protocol (described at [Sigrok wiki](https://sigrok.org/wiki/RDTech_UM_series "remote link: https://sigrok.org/wiki/RDTech_UM_series")
unsupported by this software, hence theÂ discard: messages on theÂ response). 0xF0Â requests theÂ data packet.

```
CMD: VERB:PCM
CMD: RAWSEND:F0
SEND: f0
RECV: 0d:4c:01:f8:00:a5:00:00:03:3f:00:18:00:4c:00:00
discard: 0d 4c 01Â f8Â 00Â a5Â 00Â 00Â 03Â 3f 00Â 18Â 00Â 4c 00Â 00
RECV: 00:00:21:6f:00:00:a7:a9:00:01:70:0b:00:07:34:e2:00:01:86:9f:00:0c:2c:22:00:00:07:3d:00:00:22:e2:00:00:00:00:00:00:00:00:00:00:00:00
discard: 00Â 00Â 21Â 6f 00Â 00Â a7Â a9Â 00Â 01Â 70Â 0b 00Â 07Â 34Â e2Â 00Â 01Â 86Â 9f 00Â 0c 2c 22Â 00Â 00Â 07Â 3d 00Â 00Â 22Â e2Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00
RECV: 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:01:00:00:00:08:00:00:04:2c:00:00:14:d4:00:00:4d:ef:00:01:87:d9:00:75:00:75:00:08:00:00:21:6f
discard: 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 00Â 01Â 00Â 00Â 00Â 08Â 00Â 00Â 04Â 2c 00Â 00Â 14Â d4Â 00Â 00Â 4d ef 00Â 01Â 87Â d9Â 00Â 75Â 00Â 75Â 00Â 08Â 00Â 00Â 21Â 6f
RECV: 00:00:a7:a9:00:02:00:01:6a:41:00:01:00:00:00:04:00:00:01:31:00:00:97:07
discard: 00Â 00Â a7Â a9Â 00Â 02Â 00Â 01Â 6a 41Â 00Â 01Â 00Â 00Â 00Â 04Â 00Â 00Â 01Â 31Â 00Â 00Â 97Â 07
REPLY TIMEOUT

```





---

Files
-----


* **[dl24.py](dl24.py "local file")** - code itself



---

TODO
----


* better windows compatibility
* tests on some USB power meters
* better pictures
* [SCPI](https://en.wikipedia.org/wiki/Standard_Commands_for_Programmable_Instruments "Wikipedia link: Standard Commands for Programmable Instruments") emulation/gateway
* hardware mods
+ more robust MOSFET, reverse-protection diodes
+ MOSFET gate protection with zener/transil
+ isolated 5-12v converter for powering from standard 5v usb, galvanically isolated from theÂ rest
+ maybe galv isolation of theÂ USB, like RD60xx have; unlike that one, aÂ pair of lousy optocouplers will do here as 9k6Â is slow






